---
layout: post
title:  8583国密转加密PIN上送域
date:   2019-01-29 00:00:00 +0800
categories: 8583报文
tag:  63域说明
excerpt: 63域部分简单说明
---


* content
{:toc}


---------------------------------

> 写这篇文章是之前在和中国银联联调时，当时由于做的是跨平台，所以SM4和3DES两种加密方式都需要使用兼容所有的硬件设备，才发现银联密码这部分内容已经更新，使用国密即SM4时，密码是需要在63域进行上送。52域以0的方式进行填充。

废话不说，直接上代码：  
`sprintf(sCS_finacl_net_data,"%s%s","534D303136",ToZPK_PINBLOCK);`   
> 说明如下：
* `534D3`:表示用法ID`SM`;
* `303136`:表示密码长度016,`16个字节`,用三位长度表示;
* `ToZPK_PINBLOCK`:表示经过转加密的PIN;

以上`sCS_finacl_net_data`是63域要上送的值，如果是自己拼接报文，则在拼接是还需要在前面添加该域值得整个长度。



** 52域说明文档：**

```
6.40 域 52 个人标识码数据
      Pin Data
6.40.1 变量属性
    64bit的二进制数
6.40.2 域描述
    个人标识码PIN的密文。
6.40.3 用法
    如果域22（服务点输入方式码）指明有PIN输入，则本域必须出现。客户的个人标识码(PIN)必须加密后存放在此域中。PIN的格式以及采用的加密算法在域53（安全控制信息）中标明。
    本系统允许的PIN长度最大为12位数字。详细算法请参见《数据安全传输控制规范》。
    使用SM算法时，PIN数据长度为128bit，因此，PIN数据使用域63的SM用法进行传递，域52中以二进制0填充
```

** 下面为63域简单说明截图 **
```
用法描述：
本域为多用法域，用于传递交易中的安全、风险控制相关信息。
整个域的总体格式为：
<域总长度><用法ID1><用法ID1长度><用法ID1取值>……<用法IDn><用法IDn长度><用法IDn取值>
 根据交易场景不同，本域中的用法可单独使用，也可组合使用。

用法部分说明：     

6.50.3 用法定义

用法ID|用法ID中文名称         | 用法取值格式      |   说明
----  |----                  | ----             | ----
SM    | SM4算法加密的PIN数据| 长度为16字节，数据属性b128 |用于在使用SM4递加密PIN数据
```
--------------------------------------------------
![中国银联63域详细说明截图]({{ '/styles/images/assets/2019-01-29-8583_63域说明-63域.png'| prepend: site.baseurl  }})
